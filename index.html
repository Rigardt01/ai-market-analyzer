<!DOCTYPE html>
<html>
<head>
  <title>Gold AI Analyzer (M15)</title>

  <style>
    body {
      font-family: Arial;
      background: #0f172a;
      color: white;
      text-align: center;
      margin: 0;
    }

    h1 { margin-top: 30px; }

    .card {
      background: #1e293b;
      padding: 25px;
      margin: 30px auto;
      border-radius: 16px;
      width: 360px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.4);
    }

    .buy { color: #22c55e; font-size: 22px; font-weight: bold; }
    .sell { color: #ef4444; font-size: 22px; font-weight: bold; }

    .active { color: #22c55e; }
    .expired { color: orange; }

    .tracker {
      margin-top: 20px;
      padding-top: 10px;
      border-top: 1px solid #334155;
    }

    hr {
      border: 0.5px solid #334155;
      margin: 15px 0;
    }

    #countdown { margin-top: 10px; font-weight: bold; }
  </style>
</head>

<body>

<h1>Gold AI Analyzer (15 Minute)</h1>

<div class="card" id="XAUUSD">Loading...</div>

<script>

const apiKey = "457d408780544d6c90e1276bb2ed8259";
const accountBalanceZAR = 200;
const lotSize = 0.01;
const zarRate = 19;

let totalTrades = 0;
let wins = 0;
let losses = 0;
let totalProfitZAR = 0;

async function fetchData(url){
  const response = await fetch(url);
  return await response.json();
}

async function analyze(){

  const interval = "15min";

  const data = await fetchData(
    `https://api.twelvedata.com/time_series?symbol=XAU/USD&interval=${interval}&outputsize=20&apikey=${apiKey}`
  );

  if(data.code || !data.values){
    document.getElementById("XAUUSD").innerHTML = "API limit reached or error";
    return;
  }

  const values = data.values;

  const currentClose = parseFloat(values[0].close);
  const previousClose = parseFloat(values[1].close);

  let trueRanges = [];

  for (let i = 1; i < 15; i++) {
    const high = parseFloat(values[i].high);
    const low = parseFloat(values[i].low);
    const prevClose = parseFloat(values[i - 1].close);

    const tr = Math.max(
      high - low,
      Math.abs(high - prevClose),
      Math.abs(low - prevClose)
    );

    trueRanges.push(tr);
  }

  const atrVal =
    trueRanges.reduce((a,b) => a + b, 0) / trueRanges.length;

  let signal, className;

  if(currentClose > previousClose){
    signal = "BUY";
    className = "buy";
  } else {
    signal = "SELL";
    className = "sell";
  }

  const entry = currentClose;

  let stopLoss, takeProfit;

  if(signal === "BUY"){
    stopLoss = entry - (atrVal * 1.5);
    takeProfit = entry + (atrVal * 2);
  } else {
    stopLoss = entry + (atrVal * 1.5);
    takeProfit = entry - (atrVal * 2);
  }

  const riskUSD = Math.abs(entry - stopLoss);
  const rewardUSD = Math.abs(takeProfit - entry);

  const riskZAR = riskUSD * zarRate;
  const rewardZAR = rewardUSD * zarRate;

  const riskPercentOfAccount = (riskZAR / accountBalanceZAR) * 100;

  let riskWarning = "";
  let riskColor = "lime";

  if (riskPercentOfAccount > 5) {
    riskWarning = "âš  TOO RISKY";
    riskColor = "red";
  } else if (riskPercentOfAccount > 2) {
    riskWarning = "Moderate Risk";
    riskColor = "orange";
  } else {
    riskWarning = "Safe Risk";
    riskColor = "lime";
  }

  document.getElementById("XAUUSD").innerHTML =
    `<h2>XAU/USD</h2>
     <p class="${className}">${signal}</p>
     <p>Entry: ${entry.toFixed(2)}</p>
     <p>Stop Loss: ${stopLoss.toFixed(2)}</p>
     <p>Take Profit: ${takeProfit.toFixed(2)}</p>
     <hr>
     <p>Lot Size: 0.01</p>
     <p>Risk: -${riskZAR.toFixed(2)} ZAR</p>
     <p>Reward: +${rewardZAR.toFixed(2)} ZAR</p>
     <p style="color:${riskColor}; font-weight:bold;">
       ${riskWarning} (${riskPercentOfAccount.toFixed(1)}%)
     </p>
     <p id="status"></p>
     <p id="countdown"></p>

     <div class="tracker">
       <h3>Profit Tracker</h3>
       <p>Total Trades: ${totalTrades}</p>
       <p>Wins: ${wins}</p>
       <p>Losses: ${losses}</p>
       <p>Total Profit: ${totalProfitZAR.toFixed(2)} ZAR</p>
     </div>`;
}

// Simulated trade result when signal expires
function simulateTrade(riskZAR, rewardZAR){
  totalTrades++;

  const win = Math.random() > 0.5;

  if(win){
    wins++;
    totalProfitZAR += rewardZAR;
  } else {
    losses++;
    totalProfitZAR -= riskZAR;
  }
}

function startCountdown(){

  let tradeClosed = false;

  function updateTimer(){

    const now = new Date();
    const minutes = now.getMinutes();
    const seconds = now.getSeconds();

    const remainingMinutes = 14 - (minutes % 15);
    const remainingSeconds = 59 - seconds;

    const totalSeconds =
      (remainingMinutes * 60) + remainingSeconds;

    const statusEl = document.getElementById("status");
    const countdownEl = document.getElementById("countdown");

    if(totalSeconds <= 0){
      statusEl.innerHTML = "Signal Expired";
      statusEl.className = "expired";

      if(!tradeClosed){
        // Simulate result at expiry
        simulateTrade(20, 40); 
        tradeClosed = true;
      }

    } else {
      statusEl.innerHTML = "Signal Active";
      statusEl.className = "active";
      tradeClosed = false;
    }

    const min = Math.floor(totalSeconds / 60);
    const sec = totalSeconds % 60;

    countdownEl.innerHTML =
      `Next Signal In: ${min}:${sec.toString().padStart(2,'0')}`;
  }

  updateTimer();
  setInterval(updateTimer, 1000);
}

analyze();
startCountdown();
setInterval(analyze, 300000);

</script>

</body>
</html>









